[:project
 [{nation profit.7/nation} {o_year profit.7/o_year} sum_profit]
 [:order-by
  [[profit.7/nation {:direction :asc, :null-ordering :nulls-last}]
   [profit.7/o_year {:direction :desc, :null-ordering :nulls-first}]]
  [:project
   [profit.7/nation profit.7/o_year {sum_profit xt$sum_out_8}]
   [:group-by
    [profit.7/nation
     profit.7/o_year
     {xt$sum_out_8 (sum profit.7/amount)}]
    [:rename
     profit.7
     [:project
      [{nation n.6/n_name}
       {o_year (extract "YEAR" o.5/o_orderdate)}
       {amount
        (-
         (* l.3/l_extendedprice (- 1 l.3/l_discount))
         (* ps.4/ps_supplycost l.3/l_quantity))}]
      [:mega-join
       [(= s.2/s_suppkey l.3/l_suppkey)
        (= ps.4/ps_suppkey l.3/l_suppkey)
        (= ps.4/ps_partkey l.3/l_partkey)
        (= p.1/p_partkey l.3/l_partkey)
        (= o.5/o_orderkey l.3/l_orderkey)
        (= s.2/s_nationkey n.6/n_nationkey)]
       [[:rename
         p.1
         [:scan
          {:table part}
          [p_partkey {p_name (like p_name "%green%")}]]]
        [:rename s.2 [:scan {:table supplier} [s_nationkey s_suppkey]]]
        [:rename
         l.3
         [:scan
          {:table lineitem}
          [l_partkey
           l_quantity
           l_discount
           l_suppkey
           l_orderkey
           l_extendedprice]]]
        [:rename
         ps.4
         [:scan
          {:table partsupp}
          [ps_partkey ps_suppkey ps_supplycost]]]
        [:rename o.5 [:scan {:table orders} [o_orderdate o_orderkey]]]
        [:rename
         n.6
         [:scan {:table nation} [n_nationkey n_name]]]]]]]]]]]
